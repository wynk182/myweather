<!DOCTYPE html>
  <html>
    <head>
      <meta charset="UTF-8">
      <title>What's the weather?</title>
      <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
      <link rel="stylesheet" type="text/css" href="css/beauter.min.css"/>
    <script src="js/fontawesome-all.min.js"></script>
    </head>
    <body>

      <ul class="topnav titlebar" id="myTopnav2">
        <li><a href="#" id="title">Brand</a></li>
        <li><a href="#">Settings</a></li>
        <li><a href="#">Help</a></li>
        <li style="float:right;"><a href="#" id="close-btn"><i class="fas fa-window-close"></i></a></li>
        <li style="float:right;"><a href="#" id="min-btn"><i class="fas fa-window-minimize"></i></a></li>
      </ul>
      <div id="test"></div>
      <div class="">
          <div class="row container">
              <div class="" id="data2"></div>
          </div>
          <div class="row container">
              <div class="col m6 info"><img src="" id="weather_icon" /></div>
              <div class="col m6 info"><div id="data"></div></div>
          </div>
                <!--<p id="data2"></p>-->
          </div>
      </div>

    </body>
  </html>
  <script>
  var config = [
      {
          order:1,
          state:'CA',
          city:'valley_village',
          nickname:'Home'
      },
      {
          order:3,
          state:'OR',
          city:'Salem',
          nickname:'Home town'
      },
      {
          order:2,
          state:'HI',
          city:'Honolulu',
          nickname:'Dream'
      }

  ];
  const React = require('react');
  const ReactDOM = require('react-dom');
  require('./renderer.js');
  const request = require('request');
  const remote = require('electron').remote;
  var api_key = 'f697f6a381fd3be2';

  class Weather extends React.Component {
    constructor(props){
      super(props);
      this.state = {
        title: props.object.nickname,
        icon_url: '',
        temp: '',
        location: ''
      };
    }
    componentDidMount() {
      var that = this;
      let url = 'http://api.wunderground.com/api/'+api_key+'/conditions/q/' + this.props.object.state + '/' + this.props.object.city + '.json';
      console.log(url);
      request(url, (err, response, body) => {
        if(err){
          that.setState({
            title: err
          });
        }
        else {
          //console.log(err);
          //console.log(body);
          //console.log(response);

          try{
            const weather = JSON.parse(body);
            console.log(weather);
            that.setState({
              temp: weather.current_observation.temperature_string,
              location: weather.current_observation.display_location.full,
              icon_url: weather.current_observation.icon_url.replace("/k/", "/i/")
            });
          }
          catch(error){
            that.setState({
              title: error
            });
          }
        }
      });
    }
    render() {
      return React.createElement('div', {class: 'container'},
        React.createElement('h3', null, this.state.title),
        React.createElement('img', {'src': this.state.icon_url, style: {'float':'right'}}),
        React.createElement('ul', null,
          React.createElement('li', null, this.state.temp),
          React.createElement('li', null, this.state.location),
        )
        //,
        //React.createElement('h4', null, this.state.nickname)
      );
    }
  }

  class Box extends React.Component {
    constructor(props){
      super(props);
    }
    renderWeather(obj) {
      return(
         React.createElement(Weather,{object: obj})
       )
    }
    render(){
      var that = this;
      var weathers = [];
      this.props.config.forEach(function(o){
        console.log(o);
        weathers.push(that.renderWeather(o));
      })
      return (
        weathers
      )
    }
  }

  ReactDOM.render(
    React.createElement(Box, {'config': config}, null),
    document.getElementById('test')
  );
/*
  config.forEach(function(obj){
    console.log(obj);
    getWeather(obj);
  });
*/
  //getWeather();
  function getWeather(obj){
    let url = 'http://api.wunderground.com/api/'+api_key+'/conditions/q/' + obj.state + '/' + obj.city + '.json';
    console.log(url);
    request(url, function (err, response, body) {
      if(err){
        return {'error': err};
      } else {
      //console.log(err);
      //console.log(body);
      //console.log(response);
      console.log(body);
      try{
        const weather = JSON.parse(body);
        let loc = weather.current_observation.display_location.full;
        let temp = weather.current_observation.temperature_string;
        //let loc = weather.current_observation.display_location.full;
        let icon_link = weather.current_observation.icon_url.replace("/k/", "/i/");
        let forecast = weather.current_observation.weather;
        let obs_time = weather.current_observation.observation_time;
        return {'icon_url': icon_link, 'location': loc, 'temp':temp, 'forecast':forcast, 'time': obs_time};
      }
      catch(error){

        return {'error': error};
      }


      }
    });
  }
  document.getElementById("min-btn").addEventListener("click", function (e) {
       var window = remote.getCurrentWindow();
       window.minimize();
  });

  document.getElementById("close-btn").addEventListener("click", function (e) {
       var window = remote.getCurrentWindow();
       window.close();
  });
  </script>
  <style>
      a{
          color:black;
      }
      .titlebar {
        height: 25px;
        -webkit-user-select: none;
        -webkit-app-region: drag;
      }
      ul.titlebar li a{
        margin-left: .5em;
        margin-right: .5em;
        font-size: 12px;
        padding-top:0px;
        padding-bottom:0px;
        padding-left: 5px;
        padding-right: 5px;
        -webkit-app-region: no-drag;
      }
      ul.titlebar li a:hover{
        background-color: darkgrey;
      }
  table *{
    border-color: transparent;
  }
  body{
    color:white;
    background-color: transparent;
  }
  </style>
<script src="js/beauter.min.js"></script>
